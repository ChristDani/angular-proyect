<app-modal-base
  #modalBase
  [title]="getOperationTitle()"
  [withFooter]="true"
  [buttonsInFooter]="{
    primaryButton: {
      text: 'Entendido',
      action: onClose.bind(this),
      disabled: false
    },
    secondaryButtons: []
  }"
  (closeModal)="onClose()"
>
  <div class="operation-confirm-content">
    <!-- Status Header -->
    <div class="text-center mb-4">
      @if (data.success) {
        <div class="success-icon rounded-circle bg-success text-white mx-auto mb-3">
          <i class="bi bi-check-lg"></i>
        </div>
        <h5 class="text-success fw-bold">¡Operación Exitosa!</h5>
        <p class="text-muted">Tu {{ getOperationTitle().toLowerCase() }} se completó correctamente</p>
      } @else {
        <div class="error-icon rounded-circle bg-danger text-white mx-auto mb-3">
          <i class="bi bi-x-lg"></i>
        </div>
        <h5 class="text-danger fw-bold">Operación Fallida</h5>
        <p class="text-muted">Hubo un problema al procesar tu {{ getOperationTitle().toLowerCase() }}</p>
      }
    </div>

    <!-- Operation Details -->
    @if (data.success) {
      <div class="operation-details">
        <!-- Operation ID and Timestamp -->
        <div class="detail-card mb-3">
          <div class="d-flex align-items-center mb-2">
            <i class="bi {{ getOperationIcon() }} text-primary me-2"></i>
            <h6 class="mb-0 fw-bold">Detalles de la Operación</h6>
          </div>
          <div class="row">
            <div class="col-6">
              <small class="text-muted">ID de Operación:</small>
              <p class="mb-0 fw-semibold">#{{ data.operationId }}</p>
            </div>
            <div class="col-6">
              <small class="text-muted">Fecha y Hora:</small>
              <p class="mb-0 fw-semibold">{{ formatDateTime(data.timestamp) }}</p>
            </div>
          </div>
        </div>

        <!-- Amount and Currency -->
        <div class="detail-card mb-3">
          <div class="d-flex align-items-center mb-2">
            <i class="bi bi-cash-coin text-primary me-2"></i>
            <h6 class="mb-0 fw-bold">Monto</h6>
          </div>
          <div class="amount-display text-center py-2">
            <span class="display-6 fw-bold text-primary">
              {{ formatCurrency(data.amount, data.currency) }}
            </span>
            @if (hasConversion()) {
              <div class="conversion-info mt-2">
                <small class="text-muted">Convertido a:</small>
                <p class="h5 mb-0">{{ formatCurrency(data.convertedAmount!, data.convertedCurrency!) }}</p>
                <small class="text-muted">Tasa de cambio: 1 {{ data.currency }} = {{ data.exchangeRate }} {{ data.convertedCurrency }}</small>
              </div>
            }
          </div>
        </div>

        <!-- Account Details -->
        @switch (data.type) {
          @case ('transfer-between-accounts') {
            <div class="detail-card mb-3">
              <div class="d-flex align-items-center mb-2">
                <i class="bi bi-bank text-primary me-2"></i>
                <h6 class="mb-0 fw-bold">Cuentas Involucradas</h6>
              </div>
              <div class="accounts-flow">
                <div class="account-info from-account">
                  <small class="text-muted">Desde:</small>
                  <p class="mb-1 fw-semibold">{{ data.fromAccount?.type | titlecase }}</p>
                  <small class="text-muted">{{ formatCurrency(data.fromAccount?.balance || 0, data.fromAccount?.currency || 'PEN') }}</small>
                </div>
                <div class="flow-arrow text-center">
                  <i class="bi bi-arrow-right text-primary h4"></i>
                </div>
                <div class="account-info to-account">
                  <small class="text-muted">Hacia:</small>
                  <p class="mb-1 fw-semibold">{{ data.toAccount?.type | titlecase }}</p>
                  <small class="text-muted">{{ formatCurrency(data.toAccount?.balance || 0, data.toAccount?.currency || 'PEN') }}</small>
                </div>
              </div>
            </div>
          }
          @case ('transfer-to-third') {
            <div class="detail-card mb-3">
              <div class="d-flex align-items-center mb-2">
                <i class="bi bi-bank text-primary me-2"></i>
                <h6 class="mb-0 fw-bold">Cuentas Involucradas</h6>
              </div>
              <div class="accounts-flow">
                <div class="account-info from-account">
                  <small class="text-muted">Desde:</small>
                  <p class="mb-1 fw-semibold">{{ data.fromAccount?.type | titlecase }}</p>
                  <small class="text-muted">{{ formatCurrency(data.fromAccount?.balance || 0, data.fromAccount?.currency || 'PEN') }}</small>
                </div>
                <div class="flow-arrow text-center">
                  <i class="bi bi-arrow-right text-primary h4"></i>
                </div>
                <div class="account-info to-account">
                  <small class="text-muted">Hacia:</small>
                  <p class="mb-1 fw-semibold">Cuenta Tercero</p>
                  <small class="text-muted">{{ data.thirdPartyAccount }}</small>
                </div>
              </div>
            </div>
          }
          @case ('service-payment') {
            <div class="detail-card mb-3">
              <div class="d-flex align-items-center mb-2">
                <i class="bi bi-receipt text-primary me-2"></i>
                <h6 class="mb-0 fw-bold">Servicio Pagado</h6>
              </div>
              <div class="service-info">
                <div class="d-flex align-items-center mb-2">
                  <div class="service-icon bg-success text-white rounded-circle me-3">
                    <span>{{ data.service?.name?.charAt(0) || 'S' }}</span>
                  </div>
                  <div>
                    <p class="mb-0 fw-semibold">{{ data.service?.name }}</p>
                    <small class="text-muted">{{ data.service?.category }}</small>
                  </div>
                </div>
                <div class="account-used">
                  <small class="text-muted">Pagado desde:</small>
                  <p class="mb-0 fw-semibold">{{ data.fromAccount?.type | titlecase }}</p>
                </div>
              </div>
            </div>
          }
        }

        <!-- Description if provided -->
        @if (data.description) {
          <div class="detail-card mb-3">
            <div class="d-flex align-items-center mb-2">
              <i class="bi bi-chat-text text-primary me-2"></i>
              <h6 class="mb-0 fw-bold">Descripción</h6>
            </div>
            <p class="mb-0 text-muted">{{ data.description }}</p>
          </div>
        }

        <!-- Fees if applicable -->
        @if (data.fees && data.fees > 0) {
          <div class="detail-card mb-3">
            <div class="d-flex align-items-center mb-2">
              <i class="bi bi-info-circle text-primary me-2"></i>
              <h6 class="mb-0 fw-bold">Comisiones</h6>
            </div>
            <p class="mb-0">{{ formatCurrency(data.fees, data.currency) }}</p>
          </div>
        }
      </div>
    }
  </div>
</app-modal-base>
